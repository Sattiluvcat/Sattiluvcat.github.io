<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MySql | Satti's Blog</title>
<meta name=keywords content="MySql"><meta name=description content="MySql底层知识点"><meta name=author content="Satti"><link rel=canonical href=https://Sattiluvcat.github.io/en/posts/java/mysql/><link crossorigin=anonymous href=/assets/css/stylesheet.e00b83fdc383b748a6b65d6475e5c92f3208ba86e9ccbc58b71127877002f6f0.css integrity="sha256-4AuD/cODt0imtl1kdeXJLzIIuobpzLxYtxEnh3AC9vA=" rel="preload stylesheet" as=style><link rel=icon type=image/png href=/favicon-48x48.png sizes=48x48><link rel=icon type=image/svg+xml href=/favicon.svg><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="MyWebSite"><link rel=manifest href=/site.webmanifest><link rel=alternate hreflang=en href=https://Sattiluvcat.github.io/en/posts/java/mysql/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><meta property="og:title" content="MySql"><meta property="og:description" content="MySql底层知识点"><meta property="og:type" content="article"><meta property="og:url" content="https://Sattiluvcat.github.io/en/posts/java/mysql/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-26T14:57:52+08:00"><meta property="article:modified_time" content="2024-10-26T14:57:52+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="MySql"><meta name=twitter:description content="MySql底层知识点"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://Sattiluvcat.github.io/en/posts/"},{"@type":"ListItem","position":2,"name":"Java💻","item":"https://Sattiluvcat.github.io/en/posts/java/"},{"@type":"ListItem","position":3,"name":"MySql","item":"https://Sattiluvcat.github.io/en/posts/java/mysql/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MySql","name":"MySql","description":"MySql底层知识点","keywords":["MySql"],"articleBody":" 存储引擎 MySql体系结构 MySql服务器 flowchart LR 连接层--\u003e服务层 服务层\u003c--\u003eSQL接口 服务层\u003c--\u003e解析器 服务层\u003c--\u003e查询优化器 服务层\u003c--\u003e缓存 SQL接口--\u003ed((可插拔式存储引擎)) 解析器--\u003ed 查询优化器--\u003ed 缓存--\u003ed d--\u003e存储层 存储引擎包括InnoDB等，Index信息也存储在其中 存储层存储系统文件、文件和日志等 存储引擎 存储引擎简介 存数据、建索引、更新数据等的实现方式，基于表不基于库（被称为表类型）\n建表时指定存储引擎\nCREATE TABLE 表名( … \\)ENGINE=INNODB … SHOW ENGINES; 显示支持的存储引擎\n存储引擎特点 InnoDB DML操作遵循ACID模型 支持事务 行级锁 提高并发访问性能 支持外键 以.idb表空间文件存储该表的表结构(frm sdi)、数据与索引 用cmd打开 idb2sdi ***.idb 查看表结构 数据段即为B+树的叶子节点 索引段为非叶子节点 flowchart LR Tablespace--\u003eSegment--\u003eExtent--\u003ePage--\u003erow 表空间--\u003e段--\u003e区--\u003e页--\u003e行 MyISAM 不支持事务 外键 支持表锁 不支持行锁 访问速度快 ✕✕.sdi 存储表结构信息 ✕✕.MYD 存储数据 ✕✕.MYI 存储索引 Memory 存储在内存中 只做临时文件\n内存存放 hash索引 ✕✕.sdi 存储表结构 比较 特点 InnoDB MyISAM Memory 事务安全 支持 - - 锁机制 行锁 表锁 表锁 支持外键 支持 - - B+tree索引 支持 支持 支持 Hash索引 - - 支持 全文索引 支持 支持 - 空间使用 高 低 N/A 内存使用 高 低 中 批量插入速度 低 高 高 选择 InnoDB 事务完整性\u0026并发条件 各种操作都很多 MyISAM 以读\u0026插入操作为主 少更新\u0026删除 对事务的完整性与并发性要求不高(被ControlDB取代) Memory 临时表的缓存 对表的大小有限制 安全性没有保障(被Redis取代) 索引 索引概述 帮MySql高效获取数据的数据结构（有序） 在存储引擎中实现 优点： 提高查询效率 降低IO成本 降低排序成本 降低CPU消耗 缺点： 占用磁盘空间 降低更新表的速度 索引结构 主要索引： 索引结构 描述 B+Tree索引 大部分引擎都支持 最常见 Hash索引 不支持范围查询 精确匹配索引列的查询才有效 R-Tree(空间索引) MyISAM的特殊索引 用于地理空间数据类型 Full-text(全文索引) 建立倒排索引 快速匹配文档 支持引擎： 索引 InnoDB MyISAM Memory B+Tree 支持 支持 支持 Hash索引 不支持 不支持 支持 R-Tree 不支持 支持 不支持 Full-text 支持 支持 不支持 一般索引直接指B+Tree索引 B+Tree\u0026其它Tree 二叉树：左子小于亲点 右子大于亲点 顺序插入时会形成链表 大数据量下 层级较深 效率低 红黑树：新数据会先与根节点判断大小 大数据量下 层级较深 B Tree(多路平衡查找树)： 最大度数为n，最多n个子节点，每个节点最多存储n-1个key(元素)，n个指针 中间节点向上分裂 B+Tree 所有元素都会出现在叶子节点(树只起到索引作用) 所有叶子节点形成单向链表 B+Tree in MySql 增加了指向相邻叶子节点的链表指针 形成带顺序指针的B+Tree 一页(一个磁盘块)只存放指针和key不存放数据，则一页上可以存放的指针与key相比BTree更多，故层级更少 Hash 键值换算成新的hash值 映射到对应槽位 存储在hash表中 hash冲突(多个键值映射到同个槽位)时用链表解决 特点： 只能用于对等比较 不支持范围查询 无法利用索引进行排序 查询效率高 通常只需一次检索 通常效率高于B+Tree 索引分类 分类： 索引 含义 特点 关键字 主键索引 针对主键创建的 默认自动创建 onlyone PRIMARY 唯一索引 避免同表中某列数据的值重复 可有多个 UNIQUE 常规索引 快速定位特定数据 可多个 全文索引 查找文本关键词 非比较索引中的值 可多 FULLTEXT 根据索引的存储形式分类： 聚集索引 将数据存储与索引放到一起 索引的叶子节点保存行数据(有且仅有1个) 聚集索引选取规则：主键\u003e第一个唯一索引\u003einnoDB生成rowid作为隐藏聚集索引 二级索引 将数据与索引分开存储 叶子节点关联对应主键(可有多个) 如建立name的索引 叶子节点即存储id 回表查询 eg.查询Satti的所有信息 先二级索引查主键 后聚集索引查row信息 索引语法 CREATE [UNIQUE/FULLTEXT] INDEX 索引名 ON 表名 (字段名,…); 创建索引 字段名后可指定升降序建立索引 索引名一般为 idx_表名_字段名1_字段名2 可以关联多个字段 SHOW INDEX FROM 表名[\\G]; 查看索引 \\G可以把以行显示的索引转换为列显示 DROP INDEX 索引名 ON 表名; 删除索引 SQL性能 性能分析 SHOW GLOBAL STATUS LIKE'Com____' 查询命令(Delete等)执行频次 SHOW GLOBAL STATUS提供服务器状态 7个下划线 慢查询日志 记录超过指定时间的SQL语句 SHOW VARIABLES LIKE'SLOW_QUERY_LOG‘; 检查慢查询日志是否开启 开启慢查询日志： 在MySql配置文件/etc/my.cnf中配置\n#开启慢查询 slow_query_log=1\n#设置慢日志时长\nlong_query_time=2 查看记录信息 /var/lib/mysql/localhost-slow.log profile详情 SELECT @@have_profiling; 是否支持profile操作 开启profile SET PROFILING=1 SHOW PROFILES; 查看所有指令耗时 SHOW PROFILES [CPU] FOR QUERY query号; 查看某个query的耗时(与cpu消耗) explain执行计划 在select语句前加 desc 或 explain id select查询的序列号（操作顺序） id相同 顺序从上到下 id不同 值越大越先执行 type 性能指标从好到差： NULL\u003esystem\u003econst(以上较好)\u003eeq_ref\u003eref\u003erange\u003eindex\u003eall 主键/唯一索引==const possible_key 可能用到的索引 key 实际用到的索引 key_len 索引字段最大可能长度 rows 预估执行查询的行数 filtered 返回结果行数占读取行数的比例(越大越好) 索引使用原则 最左前缀法则 联合索引时遵守\n查询从索引的最左列开始 且不跳过索引中的列（即从联合索引的第一个字段开始） 若跳过索引中某字段 则后面的字段失效 范围查询 联合索引时遵守\n即\u003e \u003c等范围限定 若出现 其右侧列索引失效 若使用\u003e=或\u003c=则不存在此问题 失效问题 索引列运算 若对索引中的字段进行运算 索引失效 包括substring等 字符串不加引号 字符串类型字段若不加引号 索引失效 模糊查询 尾部模糊查询 不失效 头部模糊查询 索引失效 or连接 or中一条件中的字段有索引 + 另一列无索引 = 索引失效 数据分布影响 如索引效率不如全表扫描时 启用全表扫描 SQL提示 EXPLAIN select语句 USE INDEX(索引名) 建议使用某索引 EXPLAIN select语句 IGNORE INDEX(索引名) 不用某索引 EXPLAIN select语句 USE INDEX(索引名) 必用某索引 覆盖索引 需要返回的列在索引中可全部找到 “using where;using index” 在列 “using index condition” 需回表查询 前缀索引 字段类型为varchar text等 需索引很长字符串——前缀索引 CREATE INDEX 索引名 ON 表名(COLUMN(N)); 创建前缀索引 N为前缀长度 选择性计算：COUNT(DEISTINCT SUBSTRING(字段名,m,n))/COUNT(\\)* 根据选择性取舍选择N的大小 单列与联合索引的选择 业务场景中存在多个查询条件 建议采用联合索引 单列易产生回表查询 索引设计原则 数据量较大（\u003e几十万） 查询频繁 常作为where、order by、group by条件的字段 区分度高的列（相对唯一 如身份证号等） 若为字符串类型 字段长度较长——前缀索引 尽量使用联合索引 控制索引数量 若索引列不能有NULL 建表时即规定NOT NULL 便于优化器选用索引 SQL优化 插入优化 基本优化 批量插入(500-1000条) 手动提交事务 主键顺序插入 大批量插入数据\n# 客户端连接服务端时加–LOCAL-INFILE\nMYSQL --LOCAL-INFILE -U ROOT -P;\n# 设置全局参数为1 允许从本地加载文件导入数据\nSET GLOBAL LOCAL_INFILE=1;\n# 执行load加载数据\nLOAD DATA LOCAL INFILE '数据地址' INTO TABLE '表名' FIELDS TERMINATED BY ',' LINES TERMINATED BY '\\n'; linux命令行：head 文件名查看文件前十行 主键优化 数据组织方式 InnoDB中 表数据按主键顺序组织存放 此种表即为索引组织表(IOT) 页分裂 （页中存放的是行数据）\n每个页包含2~n个数据（若1个 则相当于一个链表） 根据主键排列 若乱序插入 可能发生页分裂 前一页后50%部分与新数据挪至新页 新页插入前一页与后一页间 页合并 当页中删除的row达到MERGE-THRESHOLD（默认50%） InnoDB会寻找靠近的页进行合并 MERGE-THRESHOLD 合并页的阈值 可自定义 主键设计原则 尽量降低主键长度（占用的字节大小） 尽量顺序插入（自增主键） 尽量不用UUID（通用唯一识别码）或其它自然主键（如身份证号）为主键 因为无序 避免修改主键 order by优化 Extra显示 Using index 通过索引排序 Using filesort 不可通过索引直接返回排序结果 索引升序创建时 若倒序排序则需filesort 优化 根据排序字段建立合适索引 多字段排序时也遵循最左前缀 尽量使用覆盖索引\u0026注意升降序设定 不可避免出现filesort大数据量排序时 适当增加排序缓冲区sort_buffer_size大小 group by优化 extra显示 Using temporary 使用临时表（性能低） Using index 使用索引 满足最左前缀 limit优化（分页） limit不能用在in/all/any/some子语句中==多表查询 将limit的结果视为新表 覆盖索引 + 子查询 原表与分页查到的主键id表联合查询name等索引覆盖的字段 count优化 MyISAM将表的总行存在磁盘中 效率高 InnoDB需将数据从引擎中读出后累计计数 优化思路 自己计数（设定计数器cnt） 用法 count(*) 不取值 直接累加 count(主键) 取主键id值 按行累加 主键不可能为NULL count(字段) 字段为NULL时 count不加1 字段有not null约束时 不需判断null count(1) 可以取-1等 服务层对返回的每一行放1（或-1）进去 后逐行累加 效率：字段 \u003c 主键id \u003c 1 \u003c * update优化 update优先行锁（有索引字段时 锁住该行）若无索引 执行表锁 InnoDB的行锁针对索引 视图 虚拟存在的表 只保存查询的逻辑不保存结果\n视图语法 CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH [CASCADED |LOCAL] CHECK OPTION]\n创建视图（OR REPLACE或替换视图） SHOW CREATE VIEW 视图名\n查看创建视图语句\nSELECT * FROM 视图名\n查看视图 类似表 CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH [CASCADED/LOCAL] CHECK OPTION]\n修改视图（REPLACE为主要）\nALTER VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH [CASCADED/LOCAL] CHECK OPTION]\n修改视图 DROP VIEW [IF EXISTS] 视图名称 删除视图 检查选项 WITH [CASCADED/LOCAL] CHECK OPTION 使之后对视图进行的增删改操作符合视图最初的定义 CASCADED/LOCAL 检查依赖视图的规则 保持一致性 二者限定的范围不同 CASCADED （若v1未指定视图检查 但为v2的依赖视图 也会检查v1）检查所有亲辈的限制 无论其是否指定 LOCAL 若v1未指定 则不检查v1 视图更新 可更新的视图：视图中的行与基础表的行一一对应 包含 聚合/DISTINCT/GROUP BY/HAVING/UNION/… 的视图不可更新 视图作用 简单 简化理解\u0026操作（复杂且多次使用到的检索可以形成视图） 安全 可以只查看某表的部分内容（授权只能精确到表） 数据独立 屏蔽基表变化对查看信息带来的影响 存储过程 SQL语言的代码封装与重用\n特点 封装 复用 可以接收参数 返回数据 减少应用途径与数据库间的网络交互 提升效率 语法 创建存储过程 CREATE PROCEDURE 存储过程名([参数列表])* BEGIN ——SQL语句 END; 命令行中解决遇 ; 即停问题：用delimiter 某符号指定语句结束位置 在DataGrip中存储为routines 中文“例程”\nCALL 存储过程名([参数列表]) 调用存储过程 SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA='表名';\n查询指定数据库的存储过程与状态\nSELECT CREATE PROCEDURE 存储过程名\n查询某存储过程的定义 DROP PROCEDURE 存储过程名 删除存储过程 变量 系统变量 由服务器提供 分为全局变量GLOBAL与会话变量SESSION（仅在当前会话 即当前控制台 生效） 默认SESSION 系统重启后全局参数失效 可在/etc/my.cnf中配置 SHOW [SESSION/GLOBAL] VARIABLES;\n查看所有系统变量\nSHOW [SESSION/GLOBAL] VARIABLES LIKE '…';\n模糊匹配\nSELECT @@[SESSION/GLOBAL] 系统变量名;\n查看指定变量的值 系统变量用@@ SET [SESSION/GLOBAL] 系统变量名=值\nSELECT @@[SESSION/GLOBAL] 系统变量名=值\n设置系统变量 SET SESSION AUTOCOMMIT =0 切换到手动提交 用户自定义变量 不用提前声明 通过“@变量名”使用(未定义时调用返回null) 作用域为当前\nSET @变量名=值;\nSET @变量名:=值;\nSELECT @变量名=值;\n赋值 可多个同时赋值\nSELECT 字段名 INTO @变量名 FROM 表名; 将字段名结果赋值给变量 SELECT @变量名 使用变量 局部变量 作用域在begin…end块之间 先声明后调用\nDECLARE 变量名 变量类型 [DEFAULT …]; 声明（有否默认值） SET 变量名 := 值\nSELECT 字段名 INTO 变量名 FROM 表名;\n为变量赋值 条件判断\u0026循环 if IF 条件1 THEN …; ELSEIF 条件2 THEN …; ELSE …; END IF; 用SELECT语句显示返回值\n参数 类型 类型 含义 备注 IN 输入 调用时传入值 默认 OUT 输出 可为返回值 INOUT 输入\u0026输出 CREATE PROCEDURE 存储过程名([IN/OUT/INOUT 参数名 参数类型]) case CASE [变量] WHEN … THEN …; … ELSE … END CASE; while WHILE 条件 DO SQL逻辑 END WHILE 条件为true时进行 repeat REPEAT SQL逻辑 UNTIL 条件 END REPEAT 先执行一次逻辑 若条件满足则停止循环 loop [begin_label:] LOOP … END LOOP [end_label]; 配合语句： LEAVE LABEL; 退出循环 ITERATE LABEL; 只可在循环中使用 跳过当前循环剩下的语句进入下一次循环 游标\u0026条件处理程序 游标 暂时存储查询结果集的数据类型（集合）\nDECLARE 游标名 CURSOR FOR 查询语句; 声明游标 OPEN 游标名 打开游标 FETCH 游标名 INTO 变量; 获取游标记录（可以是多个变量） CLOSE 游标名 关闭游标 使用游标记录结果集 开启游标通过循环获取游标内的数据 条件处理程序 定义在流程控制结构执行过程中遇到问题的处理步骤\nDECLARE 处理动作 HANDLER FOR 状况值 … statement; 处理动作： CONTINUE 继续执行当前程序 EXIT 终止 状况值： SQLSTATE 状态码 可用下列替代 SQLWARNING（01开头的状态码） NOT FOUND（02开头的状态码） SQLEXCEPTION（除以上两种的其它） 存储函数 有返回值 参数必为IN类型（应用少）\nCREATE FUNCTION 存储函数名([参数列表]) RETURNS 数据类型 [characteristic] BEGIN ——SQL语句 END; characteristic：（二级日志开启 默认需加）\nDETERMINISTIC 相同输入产生相同结果 NO SQL 不包含SQL语句 READ SQL DATA 包含读取数据的语句 不包含写入数据的语句 触发器 触发器定义 与表有关的数据库对象。在insert/update/delete之前或之后，触发并执行其定义的语句（多为记录数据变更日志） OLD与NEW引用触发器中发生变化的记录内容 如insert用NEW；update用OLD（引用需修改的内容）与NEW（引用修改后的内容） 只支持行级触发器 不支持语句级触发 触发器语法 CREATE TRIGGER 触发器名 BEFORE/AFTER INSERT/… ON 表名 FOR EACH ROW——行级触发器 BEGIN 语句（将修改的内容放入新建的日志表中） END; 创建触发器 “语句”为将新操作记录插入日志表（自建） 可以记录插入的详细信息 用 concat() 拼接字符串 SHOW TRIGGERS; 查看触发器 DROP TRIGGER [数据库名.]触发器名; 删除触发器 锁 概述 协调多进程或线程并发访问某资源的机制 事务中进行 分类 全局锁 数据库中所有表 表级锁 行级锁 全局锁 通常用做全数据库的逻辑备份\n语法 FLUSH TABLES WITH READ LOCK 加全局锁 MYSQLDUMP -UROOT -P1234 数据库名\u003e保存地点 备份数据库 在命令行中运行 非mysql语句 用户名root 密码1234 UNLOCK TABLES 释放锁 特点（不重要） 若主库备份 备份期间不能更新主库 若从库备份 备份期间从库不能执行主库同步来的二进制日志 导致主从延迟 MYSQLDUMP --SINGLE-TRANSACTION -UROOT -P1234 数据库名\u003e保存地点 不需加全局锁的备份 表级锁 锁定粒度大 发生所冲突的概率最高 并发度最低\n分类： 表锁 元数据锁 意向锁 表锁 分类： 表共享读锁 表独占写锁 LOCK TABLES 表名… READ/WRITE 加锁 读锁 所有客户端都可读 不可写 写锁 当前客户端可读 / 写 其他客户端不可读 / 写 UNLOCK TABLES 释放锁 元数据锁(meta data lock,MDL) 系统自动控制\n维护表元数据的数据一致性==表上有活动事务时不可对元数据进行写入 避免DML与DDL冲突 MySql5.5后 DML增删改查加读锁 DDL对表结构变更加写锁 SELECT OBJECT_SCHEMA,OBJECT_NAME,INDEX_NAME,LOCK_TYPE,LOCK_MODE,LOCK_DATA FROM PERFORMANCE_SCHEMA.METADATA_LOCKS; 查看元数据锁 意向锁 使表锁不用检查每行数据是否加行锁 避免DML执行时行锁与表锁冲突 分类： 意向共享锁(IS) 意向排他锁(IX) SELECT OBJECT_SCHEMA,OBJECT_NAME,INDEX_NAME,LOCK_TYPE,LOCK_MODE,LOCK_DATA FROM PERFORMANCE_SCHEMA.DATA_LOCKS;\n查看锁 日志中RECORD锁类型代表行锁 意向锁间不互斥\nIS 意向共享锁 由SELECT语句 LOCK IN SHARE MODE添加 与表锁共享读锁(read)兼容 与表锁排它写锁(write)互斥 IX 意向排他锁 由增删改语句 FOR UPDATE添加 与表锁共享读锁(read)互斥 与表锁排它写锁(write)互斥 行级锁 锁定粒度最小 锁冲突改率最低 并发度最高 在InnoDB存储引擎中应用\n分类： 行锁 锁定单个行记录——在RC RR隔离级别下都支持（包括共享锁与排他锁） 间隙锁 确保索引记录间隙不变 防止insert产生幻读——在RR下支持 临键锁 行锁+间隙锁（该行之前的间隙）——RR下支持 行锁类型 SQL 行锁类型 说明 增删改 排他锁 自动加 SELECT语句 无锁 SELECT加共享锁 共享锁S 手动 SELECT…FOR UPDATE 排他锁X 手动 行锁 InnoDB使用next-key（临键锁）进行搜索与索引扫描 以防止幻读\n针对唯一索引检索时 对存在的记录进行等值匹配（通过 “=” 检索）时会自动将next-key锁优化为行锁 InnoDB中不通过索引检索数据会升级为表锁 间隙锁\u0026临键锁 理解 唯一索引的等值查询 给不存在的记录加锁时 优化为间隙锁 普通索引的等值查询 向右遍历到最后一个值不满足查询需求时 临键锁退化为间隙锁 唯一索引的范围查询 访问到不满足条件的第一个值为止（加锁） 间隙锁可以共存（只为防止其它事务插入间隙so） InnoDB引擎 理解 整体架构 内存架构 直接操作\n缓冲池 Buffer Pool Change Buffer 对非唯一的二级索引进行修改 操作存储在此（先到缓冲池 后到磁盘） Adaptive Hash Index 优化对缓冲池数据的查询(自动生成) 用SHOW VARIABLES LIKE '%HASH_INDEX%';查看其是否启用（模糊匹配） Log Buffer 日志缓冲区 保存要写入磁盘的log INNODB_LOG_BUFFER_SIZE查看大小 INNODB_FLUSH_LOG_AT_TRX_COMMIT刷新到磁盘的时机（可设置0 1 2 具体含义略） 磁盘结构 System Tablespaces系统表空间 主要存放Change Buffer %DATA_FILE_PATH%模糊匹配 General Tablespaces通用表空间 需在创建表时指定 CREATE TABLESPACE创建该表空间 Undo Tablespaces撤销表空间 自动创建两个 Temporary Tablespaces临时表空间 DoubleWrite Buffer Files双写缓冲区（缓冲池刷新到磁盘前先写入此） Redo Log重做日志 实现事务持久性（包括重做日志缓冲 储存在内存中） 后台线程 将缓冲区数据刷新到磁盘中\nMaster Thread核心后台线程 调度其他线程 IO Thread 负责IO请求的回调 Purge Thread 回收事务已提交的undo log Page Cleaner Thread减轻主线程刷新脏页的压力 事务原理 redo log 刷新脏页到磁盘发生错误时进行数据恢复（物理日志） undo log 回滚日志（逻辑日志） 记录数据被修改前的信息 MVCC需要 MVCC⭐ 多版本并发控制 Multi-Version Concurrency Control\n基本概念 当前读 读取记录数据的最新版本并对记录加锁 共享锁/排他锁/增删改 快照读 读取记录数据的可见（历史）版本 不加锁 RC隔断下 每次select生成一个快照读 RR 开启事务后第一个select才是快照读 S 快照读退化为当前读 MVCC 维护一个数据的多个版本 使读写操作没有冲突 快照读为其提供非阻塞读功能 依赖于： 数据库记录中的三个隐式字段 undo log readView 实现原理 三个隐式字段 （InnoDB隐式生成）\n隐藏字段 含义 DB_TRX-ID 最近修改事务ID DB_ROLL_PTR 回滚指针 指向这条记录的上个版本 配合undo log DB_ROW_ID 隐藏主键 若无指定主键则生成此字段 undo log日志（增删改时产生便于数据回滚的日志）\ninsert 只在回滚时需要log 事务提交后可被删除 删改 在回滚与快照读时需要（不会被立即删除） 生成undo log版本链 头部是最新的历史记录 尾部是最旧的历史记录 ReadView 记录并维护系统当前活跃（未提交）的事务id（MVCC提取数据的依据）\n四个核心字段 字段 含义 m_ids 当前活跃事务ID集合 min_trx_id 最小活跃事务ID max_trx_id 预分配事务ID（当前最大事务ID+1 自增） creator_trx_id ReadView创建者的事务ID 版本链数据访问规则（当前事务ID为trx_id 即DB_TRX_ID）理解 只可符合下列四个条件 若都不符合 则换下一条undo log trx_id==creator_trx_id ✔ 说明数据由当前事务更改 trx_id","wordCount":"8177","inLanguage":"en","datePublished":"2024-10-26T14:57:52+08:00","dateModified":"2024-10-26T14:57:52+08:00","author":[{"@type":"Person","name":"Satti"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://Sattiluvcat.github.io/en/posts/java/mysql/"},"publisher":{"@type":"Organization","name":"Satti's Blog","logo":{"@type":"ImageObject","url":"https://Sattiluvcat.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://Sattiluvcat.github.io/en/ accesskey=h title="Satti's Blog (Alt + H)"><img src=https://Sattiluvcat.github.io/img/label1.jpg alt aria-label=logo height=35>Satti's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://Sattiluvcat.github.io/en/search/ title="🔍搜索 (Alt + /)" accesskey=/><span>🔍搜索</span></a></li><li><a href=https://Sattiluvcat.github.io/en/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://Sattiluvcat.github.io/en/posts title=📔文章><span>📔文章</span></a></li><li><a href=https://Sattiluvcat.github.io/en/tags title=📑标签><span>📑标签</span></a></li><li><a href=https://Sattiluvcat.github.io/en/lulu/ title=😽Lulu><span>😽Lulu</span></a></li><li><a href=https://Sattiluvcat.github.io/en/about/ title=😎关于><span>😎关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://Sattiluvcat.github.io/en/>Home</a>&nbsp;»&nbsp;<a href=https://Sattiluvcat.github.io/en/posts/>文章</a>&nbsp;»&nbsp;<a href=https://Sattiluvcat.github.io/en/posts/java/>Java💻</a></div><h1 class="post-title entry-hint-parent">MySql</h1><div class=post-description>MySql底层知识点</div><div class=post-meta><span title='2024-10-26 14:57:52 +0800 +0800'>2024-10-26</span>&nbsp;·&nbsp;17 min&nbsp;·&nbsp;Satti</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e aria-label=存储引擎>存储引擎</a><ul><li><a href=#mysql%e4%bd%93%e7%b3%bb%e7%bb%93%e6%9e%84 aria-label=MySql体系结构>MySql体系结构</a></li><li><a href=#%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e-1 aria-label=存储引擎>存储引擎</a><ul><li><a href=#%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e%e7%ae%80%e4%bb%8b aria-label=存储引擎简介>存储引擎简介</a></li><li><a href=#%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e%e7%89%b9%e7%82%b9 aria-label=存储引擎特点>存储引擎特点</a><ul><li><a href=#innodb aria-label=InnoDB>InnoDB</a></li><li><a href=#myisam aria-label=MyISAM>MyISAM</a></li><li><a href=#memory aria-label=Memory>Memory</a></li><li><a href=#%e6%af%94%e8%be%83 aria-label=比较>比较</a></li><li><a href=#%e9%80%89%e6%8b%a9 aria-label=选择>选择</a></li></ul></li></ul></li></ul></li><li><a href=#%e7%b4%a2%e5%bc%95 aria-label=索引>索引</a><ul><li><a href=#%e7%b4%a2%e5%bc%95%e6%a6%82%e8%bf%b0 aria-label=索引概述>索引概述</a></li><li><a href=#%e7%b4%a2%e5%bc%95%e7%bb%93%e6%9e%84 aria-label=索引结构>索引结构</a><ul><li><a href=#btree%e5%85%b6%e5%ae%83tree aria-label=B+Tree&其它Tree>B+Tree&其它Tree</a></li><li><a href=#hash aria-label=Hash>Hash</a></li></ul></li><li><a href=#%e7%b4%a2%e5%bc%95%e5%88%86%e7%b1%bb aria-label=索引分类>索引分类</a></li><li><a href=#%e7%b4%a2%e5%bc%95%e8%af%ad%e6%b3%95 aria-label=索引语法>索引语法</a></li><li><a href=#sql%e6%80%a7%e8%83%bd aria-label=SQL性能>SQL性能</a><ul><li><a href=#%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90 aria-label=性能分析>性能分析</a></li><li><a href=#%e6%85%a2%e6%9f%a5%e8%af%a2%e6%97%a5%e5%bf%97 aria-label=慢查询日志>慢查询日志</a></li><li><a href=#profile%e8%af%a6%e6%83%85 aria-label=profile详情>profile详情</a></li><li><a href=#explain%e6%89%a7%e8%a1%8c%e8%ae%a1%e5%88%92 aria-label=explain执行计划>explain执行计划</a></li></ul></li><li><a href=#%e7%b4%a2%e5%bc%95%e4%bd%bf%e7%94%a8%e5%8e%9f%e5%88%99 aria-label=索引使用原则>索引使用原则</a><ul><li><a href=#%e6%9c%80%e5%b7%a6%e5%89%8d%e7%bc%80%e6%b3%95%e5%88%99 aria-label=最左前缀法则>最左前缀法则</a></li><li><a href=#%e8%8c%83%e5%9b%b4%e6%9f%a5%e8%af%a2 aria-label=范围查询>范围查询</a></li><li><a href=#%e5%a4%b1%e6%95%88%e9%97%ae%e9%a2%98 aria-label=失效问题>失效问题</a></li><li><a href=#sql%e6%8f%90%e7%a4%ba aria-label=SQL提示>SQL提示</a></li><li><a href=#%e8%a6%86%e7%9b%96%e7%b4%a2%e5%bc%95 aria-label=覆盖索引>覆盖索引</a></li><li><a href=#%e5%89%8d%e7%bc%80%e7%b4%a2%e5%bc%95 aria-label=前缀索引>前缀索引</a></li><li><a href=#%e5%8d%95%e5%88%97%e4%b8%8e%e8%81%94%e5%90%88%e7%b4%a2%e5%bc%95%e7%9a%84%e9%80%89%e6%8b%a9 aria-label=单列与联合索引的选择>单列与联合索引的选择</a></li></ul></li><li><a href=#%e7%b4%a2%e5%bc%95%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99 aria-label=索引设计原则>索引设计原则</a></li></ul></li><li><a href=#sql%e4%bc%98%e5%8c%96 aria-label=SQL优化>SQL优化</a><ul><li><a href=#%e6%8f%92%e5%85%a5%e4%bc%98%e5%8c%96 aria-label=插入优化>插入优化</a></li><li><a href=#%e4%b8%bb%e9%94%ae%e4%bc%98%e5%8c%96 aria-label=主键优化>主键优化</a><ul><li><a href=#%e6%95%b0%e6%8d%ae%e7%bb%84%e7%bb%87%e6%96%b9%e5%bc%8f aria-label=数据组织方式>数据组织方式</a></li><li><a href=#%e9%a1%b5%e5%88%86%e8%a3%82 aria-label=页分裂>页分裂</a></li><li><a href=#%e9%a1%b5%e5%90%88%e5%b9%b6 aria-label=页合并>页合并</a></li><li><a href=#%e4%b8%bb%e9%94%ae%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99 aria-label=主键设计原则>主键设计原则</a></li></ul></li><li><a href=#order-by%e4%bc%98%e5%8c%96 aria-label="order by优化">order by优化</a><ul><li><a href=#extra%e6%98%be%e7%a4%ba aria-label=Extra显示>Extra显示</a></li><li><a href=#%e4%bc%98%e5%8c%96 aria-label=优化>优化</a></li></ul></li><li><a href=#group-by%e4%bc%98%e5%8c%96 aria-label="group by优化">group by优化</a><ul><li><a href=#extra%e6%98%be%e7%a4%ba-1 aria-label=extra显示>extra显示</a></li></ul></li><li><a href=#limit%e4%bc%98%e5%8c%96%e5%88%86%e9%a1%b5 aria-label=limit优化（分页）>limit优化（分页）</a></li><li><a href=#count%e4%bc%98%e5%8c%96 aria-label=count优化>count优化</a><ul><li><a href=#%e4%bc%98%e5%8c%96%e6%80%9d%e8%b7%af aria-label=优化思路>优化思路</a></li><li><a href=#%e7%94%a8%e6%b3%95 aria-label=用法>用法</a></li></ul></li><li><a href=#update%e4%bc%98%e5%8c%96 aria-label=update优化>update优化</a></li></ul></li><li><a href=#%e8%a7%86%e5%9b%be aria-label=视图>视图</a><ul><li><a href=#%e8%a7%86%e5%9b%be%e8%af%ad%e6%b3%95 aria-label=视图语法>视图语法</a></li><li><a href=#%e6%a3%80%e6%9f%a5%e9%80%89%e9%a1%b9 aria-label=检查选项>检查选项</a></li><li><a href=#%e8%a7%86%e5%9b%be%e6%9b%b4%e6%96%b0 aria-label=视图更新>视图更新</a></li><li><a href=#%e8%a7%86%e5%9b%be%e4%bd%9c%e7%94%a8 aria-label=视图作用>视图作用</a></li></ul></li><li><a href=#%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b aria-label=存储过程>存储过程</a><ul><li><a href=#%e7%89%b9%e7%82%b9 aria-label=特点>特点</a></li><li><a href=#%e8%af%ad%e6%b3%95 aria-label=语法>语法</a></li><li><a href=#%e5%8f%98%e9%87%8f aria-label=变量>变量</a><ul><li><a href=#%e7%b3%bb%e7%bb%9f%e5%8f%98%e9%87%8f aria-label=系统变量>系统变量</a></li><li><a href=#%e7%94%a8%e6%88%b7%e8%87%aa%e5%ae%9a%e4%b9%89%e5%8f%98%e9%87%8f aria-label=用户自定义变量>用户自定义变量</a></li><li><a href=#%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f aria-label=局部变量>局部变量</a></li></ul></li><li><a href=#%e6%9d%a1%e4%bb%b6%e5%88%a4%e6%96%ad%e5%be%aa%e7%8e%af aria-label=条件判断&循环>条件判断&循环</a><ul><li><a href=#if aria-label=if>if</a></li><li><a href=#%e5%8f%82%e6%95%b0 aria-label=参数>参数</a></li><li><a href=#case aria-label=case>case</a></li><li><a href=#while aria-label=while>while</a></li><li><a href=#repeat aria-label=repeat>repeat</a></li><li><a href=#loop aria-label=loop>loop</a></li></ul></li><li><a href=#%e6%b8%b8%e6%a0%87%e6%9d%a1%e4%bb%b6%e5%a4%84%e7%90%86%e7%a8%8b%e5%ba%8f aria-label=游标&条件处理程序>游标&条件处理程序</a><ul><li><a href=#%e6%b8%b8%e6%a0%87 aria-label=游标>游标</a></li><li><a href=#%e6%9d%a1%e4%bb%b6%e5%a4%84%e7%90%86%e7%a8%8b%e5%ba%8f aria-label=条件处理程序>条件处理程序</a></li></ul></li></ul></li><li><a href=#%e5%ad%98%e5%82%a8%e5%87%bd%e6%95%b0 aria-label=存储函数>存储函数</a></li><li><a href=#%e8%a7%a6%e5%8f%91%e5%99%a8 aria-label=触发器>触发器</a><ul><li><a href=#%e8%a7%a6%e5%8f%91%e5%99%a8%e5%ae%9a%e4%b9%89 aria-label=触发器定义>触发器定义</a></li><li><a href=#%e8%a7%a6%e5%8f%91%e5%99%a8%e8%af%ad%e6%b3%95 aria-label=触发器语法>触发器语法</a></li></ul></li><li><a href=#%e9%94%81 aria-label=锁>锁</a><ul><li><a href=#%e6%a6%82%e8%bf%b0 aria-label=概述>概述</a></li><li><a href=#%e5%85%a8%e5%b1%80%e9%94%81 aria-label=全局锁>全局锁</a><ul><li><a href=#%e8%af%ad%e6%b3%95-1 aria-label=语法>语法</a></li><li><a href=#%e7%89%b9%e7%82%b9%e4%b8%8d%e9%87%8d%e8%a6%81 aria-label=特点（不重要）>特点（不重要）</a></li></ul></li><li><a href=#%e8%a1%a8%e7%ba%a7%e9%94%81 aria-label=表级锁>表级锁</a><ul><li><a href=#%e8%a1%a8%e9%94%81 aria-label=表锁>表锁</a></li><li><a href=#%e5%85%83%e6%95%b0%e6%8d%ae%e9%94%81meta-data-lockmdl aria-label="元数据锁(meta data lock,MDL)">元数据锁(meta data lock,MDL)</a></li><li><a href=#%e6%84%8f%e5%90%91%e9%94%81 aria-label=意向锁>意向锁</a><ul><li><a href=#is-%e6%84%8f%e5%90%91%e5%85%b1%e4%ba%ab%e9%94%81 aria-label="IS 意向共享锁">IS 意向共享锁</a></li><li><a href=#ix-%e6%84%8f%e5%90%91%e6%8e%92%e4%bb%96%e9%94%81 aria-label="IX 意向排他锁">IX 意向排他锁</a></li></ul></li></ul></li><li><a href=#%e8%a1%8c%e7%ba%a7%e9%94%81 aria-label=行级锁>行级锁</a><ul><li><a href=#%e8%a1%8c%e9%94%81 aria-label=行锁>行锁</a></li><li><a href=#%e9%97%b4%e9%9a%99%e9%94%81%e4%b8%b4%e9%94%ae%e9%94%81-font-color32cd32%e7%90%86%e8%a7%a3font aria-label="间隙锁&临键锁 理解">间隙锁&临键锁 理解</a></li></ul></li></ul></li><li><a href=#innodb%e5%bc%95%e6%93%8e-font-color32cd32%e7%90%86%e8%a7%a3font aria-label="InnoDB引擎 理解">InnoDB引擎 理解</a><ul><li><a href=#%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84 aria-label=整体架构>整体架构</a><ul><li><a href=#%e5%86%85%e5%ad%98%e6%9e%b6%e6%9e%84 aria-label=内存架构>内存架构</a></li><li><a href=#%e7%a3%81%e7%9b%98%e7%bb%93%e6%9e%84 aria-label=磁盘结构>磁盘结构</a></li><li><a href=#%e5%90%8e%e5%8f%b0%e7%ba%bf%e7%a8%8b aria-label=后台线程>后台线程</a></li></ul></li><li><a href=#%e4%ba%8b%e5%8a%a1%e5%8e%9f%e7%90%86 aria-label=事务原理>事务原理</a><ul><li><a href=#redo-log aria-label="redo log">redo log</a></li><li><a href=#undo-log aria-label="undo log">undo log</a></li></ul></li><li><a href=#mvcc aria-label=MVCC⭐>MVCC⭐</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5 aria-label=基本概念>基本概念</a></li><li><a href=#%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86 aria-label=实现原理>实现原理</a></li></ul></li></ul></li><li><a href=#mysql%e7%ae%a1%e7%90%86 aria-label=MySql管理>MySql管理</a><ul><li><a href=#%e7%b3%bb%e7%bb%9f%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label=系统数据库>系统数据库</a></li><li><a href=#%e5%b8%b8%e7%94%a8%e5%b7%a5%e5%85%b7 aria-label=常用工具>常用工具</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p> </p><p> </p><h2 id=存储引擎>存储引擎<a hidden class=anchor aria-hidden=true href=#存储引擎>#</a></h2><h3 id=mysql体系结构>MySql体系结构<a hidden class=anchor aria-hidden=true href=#mysql体系结构>#</a></h3><ol><li>MySql服务器<pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
连接层--&gt;服务层
服务层&lt;--&gt;SQL接口
服务层&lt;--&gt;解析器
服务层&lt;--&gt;查询优化器
服务层&lt;--&gt;缓存
SQL接口--&gt;d((可插拔式存储引擎))
解析器--&gt;d
查询优化器--&gt;d
缓存--&gt;d
d--&gt;存储层
</code></pre><ul><li>存储引擎包括InnoDB等，Index信息也存储在其中</li><li>存储层存储系统文件、文件和日志等
<img loading=lazy src=2.jpg alt=系统结构图 title=系统图></li></ul></li></ol><h3 id=存储引擎-1>存储引擎<a hidden class=anchor aria-hidden=true href=#存储引擎-1>#</a></h3><h4 id=存储引擎简介>存储引擎简介<a hidden class=anchor aria-hidden=true href=#存储引擎简介>#</a></h4><ol><li><p>存数据、建索引、更新数据等的实现方式，基于表不基于库（被称为表类型）</p></li><li><p>建表时指定存储引擎</p><pre tabindex=0><code>CREATE TABLE 表名(
…
\)ENGINE=INNODB …
</code></pre></li><li><p><code>SHOW ENGINES;</code>
显示支持的存储引擎</p></li></ol><h4 id=存储引擎特点>存储引擎特点<a hidden class=anchor aria-hidden=true href=#存储引擎特点>#</a></h4><h5 id=innodb>InnoDB<a hidden class=anchor aria-hidden=true href=#innodb>#</a></h5><ul><li>DML操作遵循ACID模型 支持<strong>事务</strong></li><li><strong>行级锁</strong> 提高并发访问性能</li><li>支持<strong>外键</strong></li></ul><ol><li>以.idb<strong>表空间</strong>文件存储该表的表结构(frm sdi)、数据与索引</li><li>用cmd打开 idb2sdi ***.idb 查看表结构</li><li>数据段即为B+树的叶子节点 索引段为非叶子节点</li></ol><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
Tablespace--&gt;Segment--&gt;Extent--&gt;Page--&gt;row
表空间--&gt;段--&gt;区--&gt;页--&gt;行
</code></pre><p><img loading=lazy src=1.jpg alt=逻辑存储结构图 title=逻辑图></p><h5 id=myisam>MyISAM<a hidden class=anchor aria-hidden=true href=#myisam>#</a></h5><ul><li>不支持事务 外键</li><li>支持表锁 不支持行锁</li><li>访问速度快</li></ul><ol><li>✕✕.sdi 存储表结构信息
✕✕.MYD 存储数据
✕✕.MYI 存储索引</li></ol><h5 id=memory>Memory<a hidden class=anchor aria-hidden=true href=#memory>#</a></h5><p>存储在内存中 只做临时文件</p><ul><li>内存存放</li><li>hash索引</li></ul><ol><li>✕✕.sdi 存储表结构</li></ol><h5 id=比较>比较<a hidden class=anchor aria-hidden=true href=#比较>#</a></h5><table><thead><tr><th style=text-align:center>特点</th><th style=text-align:center>InnoDB</th><th style=text-align:center>MyISAM</th><th style=text-align:center>Memory</th></tr></thead><tbody><tr><td style=text-align:center>事务安全</td><td style=text-align:center>支持</td><td style=text-align:center>-</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>锁机制</td><td style=text-align:center>行锁</td><td style=text-align:center>表锁</td><td style=text-align:center>表锁</td></tr><tr><td style=text-align:center>支持外键</td><td style=text-align:center>支持</td><td style=text-align:center>-</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>B+tree索引</td><td style=text-align:center>支持</td><td style=text-align:center>支持</td><td style=text-align:center>支持</td></tr><tr><td style=text-align:center>Hash索引</td><td style=text-align:center>-</td><td style=text-align:center>-</td><td style=text-align:center>支持</td></tr><tr><td style=text-align:center>全文索引</td><td style=text-align:center>支持</td><td style=text-align:center>支持</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>空间使用</td><td style=text-align:center>高</td><td style=text-align:center>低</td><td style=text-align:center>N/A</td></tr><tr><td style=text-align:center>内存使用</td><td style=text-align:center>高</td><td style=text-align:center>低</td><td style=text-align:center>中</td></tr><tr><td style=text-align:center>批量插入速度</td><td style=text-align:center>低</td><td style=text-align:center>高</td><td style=text-align:center>高</td></tr></tbody></table><h5 id=选择>选择<a hidden class=anchor aria-hidden=true href=#选择>#</a></h5><ul><li>InnoDB 事务完整性&并发条件 各种操作都很多</li><li>MyISAM 以读&插入操作为主 少更新&删除 对事务的完整性与并发性要求不高(被ControlDB取代)</li><li>Memory 临时表的缓存 对表的大小有限制 安全性没有保障(被Redis取代)</li></ul><h2 id=索引>索引<a hidden class=anchor aria-hidden=true href=#索引>#</a></h2><h3 id=索引概述>索引概述<a hidden class=anchor aria-hidden=true href=#索引概述>#</a></h3><ol><li>帮MySql高效获取数据的数据结构（有序）<ul><li>在存储引擎中实现</li></ul></li><li>优点：<ul><li>提高查询效率 降低IO成本</li><li>降低排序成本 降低CPU消耗</li></ul></li><li>缺点：<ul><li>占用磁盘空间</li><li>降低更新表的速度</li></ul></li></ol><h3 id=索引结构>索引结构<a hidden class=anchor aria-hidden=true href=#索引结构>#</a></h3><ol><li>主要索引：<table><thead><tr><th style=text-align:center>索引结构</th><th style=text-align:center>描述</th></tr></thead><tbody><tr><td style=text-align:center>B+Tree索引</td><td style=text-align:center>大部分引擎都支持 最常见</td></tr><tr><td style=text-align:center>Hash索引</td><td style=text-align:center>不支持范围查询 精确匹配索引列的查询才有效</td></tr><tr><td style=text-align:center>R-Tree(空间索引)</td><td style=text-align:center>MyISAM的特殊索引 用于地理空间数据类型</td></tr><tr><td style=text-align:center>Full-text(全文索引)</td><td style=text-align:center>建立倒排索引 快速匹配文档</td></tr></tbody></table></li><li>支持引擎：<table><thead><tr><th style=text-align:center>索引</th><th style=text-align:center>InnoDB</th><th style=text-align:center>MyISAM</th><th style=text-align:center>Memory</th></tr></thead><tbody><tr><td style=text-align:center>B+Tree</td><td style=text-align:center>支持</td><td style=text-align:center>支持</td><td style=text-align:center>支持</td></tr><tr><td style=text-align:center>Hash索引</td><td style=text-align:center>不支持</td><td style=text-align:center>不支持</td><td style=text-align:center>支持</td></tr><tr><td style=text-align:center>R-Tree</td><td style=text-align:center>不支持</td><td style=text-align:center>支持</td><td style=text-align:center>不支持</td></tr><tr><td style=text-align:center>Full-text</td><td style=text-align:center>支持</td><td style=text-align:center>支持</td><td style=text-align:center>不支持</td></tr></tbody></table><ul><li>一般索引直接指B+Tree索引</li></ul></li></ol><h4 id=btree其它tree>B+Tree&其它Tree<a hidden class=anchor aria-hidden=true href=#btree其它tree>#</a></h4><ol><li>二叉树：左子小于亲点 右子大于亲点<ul><li>顺序插入时会形成链表</li><li>大数据量下 层级较深 效率低</li></ul></li><li>红黑树：新数据会先与根节点判断大小<ul><li>大数据量下 层级较深</li></ul></li><li>B Tree(多路平衡查找树)：
最大度数为n，最多n个子节点，每个节点最多存储n-1个key(元素)，n个指针
中间节点<strong>向上</strong>分裂</li><li>B+Tree<ul><li>所有元素都会出现在叶子节点(树只起到索引作用)</li><li>所有叶子节点形成<strong>单向链表</strong></li></ul></li><li>B+Tree in MySql<ul><li>增加了指向相邻叶子节点的链表指针 形成带顺序指针的B+Tree<ul><li>一页(一个磁盘块)只存放指针和key不存放数据，则一页上可以存放的指针与key相比BTree更多，故层级更少
<img loading=lazy src=4.jpg alt=B+tree>
<img loading=lazy src=3.jpg alt=B+tree></li></ul></li></ul></li></ol><h4 id=hash>Hash<a hidden class=anchor aria-hidden=true href=#hash>#</a></h4><ol><li>键值换算成新的hash值 映射到对应槽位 存储在hash表中<ul><li>hash冲突(多个键值映射到同个槽位)时用链表解决</li></ul></li><li>特点：<ul><li>只能用于对等比较 不支持范围查询</li><li>无法利用索引进行排序</li><li>查询效率高 通常只需一次检索 通常效率高于B+Tree</li></ul></li></ol><h3 id=索引分类>索引分类<a hidden class=anchor aria-hidden=true href=#索引分类>#</a></h3><ol><li>分类：<table><thead><tr><th style=text-align:center>索引</th><th style=text-align:center>含义</th><th style=text-align:center>特点</th><th style=text-align:center>关键字</th></tr></thead><tbody><tr><td style=text-align:center>主键索引</td><td style=text-align:center>针对主键创建的</td><td style=text-align:center>默认自动创建 onlyone</td><td style=text-align:center>PRIMARY</td></tr><tr><td style=text-align:center>唯一索引</td><td style=text-align:center>避免同表中某列数据的值重复</td><td style=text-align:center>可有多个</td><td style=text-align:center>UNIQUE</td></tr><tr><td style=text-align:center>常规索引</td><td style=text-align:center>快速定位特定数据</td><td style=text-align:center>可多个</td><td></td></tr><tr><td style=text-align:center>全文索引</td><td style=text-align:center>查找文本关键词 非比较索引中的值</td><td style=text-align:center>可多</td><td style=text-align:center>FULLTEXT</td></tr></tbody></table></li><li>根据索引的存储形式分类：<ul><li>聚集索引 将数据存储与索引放到一起 索引的叶子节点保存<strong>行</strong>数据(有且仅有1个)<ul><li>聚集索引选取规则：主键>第一个唯一索引>innoDB生成rowid作为隐藏聚集索引</li></ul></li><li>二级索引 将数据与索引分开存储 叶子节点关联对应主键(可有多个)<ul><li>如建立name的索引 叶子节点即存储id</li></ul></li></ul></li><li>回表查询
eg.查询Satti的所有信息<ul><li>先二级索引查主键 后聚集索引查row信息</li></ul></li></ol><h3 id=索引语法>索引语法<a hidden class=anchor aria-hidden=true href=#索引语法>#</a></h3><ol><li><code>CREATE [UNIQUE/FULLTEXT] INDEX 索引名 ON 表名 (字段名,…);</code>
创建索引<ul><li>字段名后可指定升降序建立索引</li><li>索引名一般为 <strong>idx_表名_字段名1_字段名2</strong></li><li>可以关联多个字段</li></ul></li><li><code>SHOW INDEX FROM 表名[\G];</code>
查看索引<ul><li>\G可以把以行显示的索引转换为列显示</li></ul></li><li><code>DROP INDEX 索引名 ON 表名;</code>
删除索引</li></ol><h3 id=sql性能>SQL性能<a hidden class=anchor aria-hidden=true href=#sql性能>#</a></h3><h4 id=性能分析>性能分析<a hidden class=anchor aria-hidden=true href=#性能分析>#</a></h4><ol><li><code>SHOW GLOBAL STATUS LIKE'Com____'</code>
查询命令(Delete等)执行频次<ul><li><code>SHOW GLOBAL STATUS</code>提供服务器状态</li><li>7个下划线</li></ul></li></ol><h4 id=慢查询日志>慢查询日志<a hidden class=anchor aria-hidden=true href=#慢查询日志>#</a></h4><ol><li>记录超过指定时间的SQL语句</li><li><code>SHOW VARIABLES LIKE'SLOW_QUERY_LOG‘;</code>
检查慢查询日志是否开启</li><li>开启慢查询日志：<ul><li>在MySql配置文件/etc/my.cnf中配置<br>#开启慢查询
<code>slow_query_log=1</code><br>#设置慢日志时长<br><code>long_query_time=2</code></li><li>查看记录信息
<code>/var/lib/mysql/localhost-slow.log</code></li></ul></li></ol><h4 id=profile详情>profile详情<a hidden class=anchor aria-hidden=true href=#profile详情>#</a></h4><ol><li><code>SELECT @@have_profiling;</code>
是否支持profile操作<ul><li>开启profile <code>SET PROFILING=1</code></li></ul></li><li><code>SHOW PROFILES;</code>
查看所有指令耗时</li><li><code>SHOW PROFILES [CPU] FOR QUERY query号;</code>
查看某个query的耗时(与cpu消耗)</li></ol><h4 id=explain执行计划>explain执行计划<a hidden class=anchor aria-hidden=true href=#explain执行计划>#</a></h4><ol><li>在select语句前加 <code>desc</code> 或 <code>explain</code><ul><li>id select查询的序列号（操作顺序）<ul><li>id相同 顺序从上到下</li><li>id不同 值越大越先执行</li></ul></li><li>type 性能指标从好到差：<ul><li>NULL>system>const(以上较好)>eq_ref>ref>range>index>all<ul><li>主键/唯一索引==const</li></ul></li></ul></li><li>possible_key 可能用到的索引</li><li>key 实际用到的索引</li><li>key_len 索引字段最大可能长度</li><li>rows 预估执行查询的行数</li><li>filtered 返回结果行数占读取行数的比例(越大越好)</li></ul></li></ol><h3 id=索引使用原则>索引使用原则<a hidden class=anchor aria-hidden=true href=#索引使用原则>#</a></h3><h4 id=最左前缀法则>最左前缀法则<a hidden class=anchor aria-hidden=true href=#最左前缀法则>#</a></h4><blockquote><p>联合索引时遵守</p></blockquote><ol><li>查询从索引的最左列开始 且不跳过索引中的列（即从联合索引的第一个字段开始）</li><li>若跳过索引中某字段 则后面的字段失效</li></ol><h4 id=范围查询>范围查询<a hidden class=anchor aria-hidden=true href=#范围查询>#</a></h4><blockquote><p>联合索引时遵守</p></blockquote><ol><li>即> &lt;等范围限定</li><li>若出现 其右侧列索引失效</li><li>若使用>=或&lt;=则不存在此问题</li></ol><h4 id=失效问题>失效问题<a hidden class=anchor aria-hidden=true href=#失效问题>#</a></h4><ol><li>索引列运算<ul><li>若对索引中的字段进行运算 索引失效<ul><li>包括<code>substring</code>等</li></ul></li></ul></li><li>字符串不加引号<ul><li>字符串类型字段若不加引号 索引失效</li></ul></li><li>模糊查询<ul><li>尾部模糊查询 不失效</li><li>头部模糊查询 索引失效</li></ul></li><li>or连接<ul><li>or中一条件中的字段有索引 + 另一列无索引 = 索引失效</li></ul></li><li>数据分布影响<ul><li>如索引效率不如全表扫描时 启用全表扫描</li></ul></li></ol><h4 id=sql提示>SQL提示<a hidden class=anchor aria-hidden=true href=#sql提示>#</a></h4><ol><li><code>EXPLAIN select语句 USE INDEX(索引名)</code>
建议使用某索引</li><li><code>EXPLAIN select语句 IGNORE INDEX(索引名)</code>
不用某索引</li><li><code>EXPLAIN select语句 USE INDEX(索引名)</code>
必用某索引</li></ol><h4 id=覆盖索引>覆盖索引<a hidden class=anchor aria-hidden=true href=#覆盖索引>#</a></h4><ol><li>需要返回的列在索引中可全部找到<ul><li>&ldquo;using where;using index&rdquo; 在列</li><li>&ldquo;using index condition&rdquo; 需回表查询</li></ul></li></ol><h4 id=前缀索引>前缀索引<a hidden class=anchor aria-hidden=true href=#前缀索引>#</a></h4><ol><li>字段类型为varchar text等 需索引很长字符串——前缀索引</li><li><code>CREATE INDEX 索引名 ON 表名(COLUMN(N));</code>
创建前缀索引 N为前缀长度<ul><li>选择性计算：<code>COUNT(DEISTINCT SUBSTRING(字段名,m,n))/COUNT(\</code>)*<ul><li>根据选择性取舍选择N的大小</li></ul></li></ul></li></ol><h4 id=单列与联合索引的选择>单列与联合索引的选择<a hidden class=anchor aria-hidden=true href=#单列与联合索引的选择>#</a></h4><ol><li>业务场景中存在多个查询条件 建议采用联合索引<ul><li>单列易产生回表查询</li></ul></li></ol><h3 id=索引设计原则>索引设计原则<a hidden class=anchor aria-hidden=true href=#索引设计原则>#</a></h3><ol><li>数据量较大（>几十万） 查询频繁</li><li>常作为where、order by、group by条件的字段</li><li>区分度高的列（相对唯一 如身份证号等）</li><li>若为字符串类型 字段长度较长——前缀索引</li><li>尽量使用联合索引</li><li>控制索引数量</li><li>若索引列不能有NULL 建表时即规定NOT NULL 便于优化器选用索引</li></ol><h2 id=sql优化>SQL优化<a hidden class=anchor aria-hidden=true href=#sql优化>#</a></h2><h3 id=插入优化>插入优化<a hidden class=anchor aria-hidden=true href=#插入优化>#</a></h3><ol><li>基本优化<ul><li>批量插入(500-1000条)</li><li>手动提交事务</li><li>主键顺序插入</li></ul></li><li>大批量插入数据<br># 客户端连接服务端时加&ndash;LOCAL-INFILE<br><code>MYSQL --LOCAL-INFILE -U ROOT -P;</code><br># 设置全局参数为1 允许从本地加载文件导入数据<br><code>SET GLOBAL LOCAL_INFILE=1;</code><br># 执行load加载数据<br><code>LOAD DATA LOCAL INFILE '数据地址' INTO TABLE '表名' FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n';</code><ul><li>linux命令行：<code>head 文件名</code>查看文件前十行</li></ul></li></ol><h3 id=主键优化>主键优化<a hidden class=anchor aria-hidden=true href=#主键优化>#</a></h3><h4 id=数据组织方式>数据组织方式<a hidden class=anchor aria-hidden=true href=#数据组织方式>#</a></h4><ol><li>InnoDB中 表数据按<strong>主键顺序</strong>组织存放</li><li>此种表即为索引组织表(IOT)</li></ol><h4 id=页分裂>页分裂<a hidden class=anchor aria-hidden=true href=#页分裂>#</a></h4><blockquote><p>（页中存放的是行数据）</p></blockquote><ol><li>每个页包含2~n个数据（若1个 则相当于一个链表） <strong>根据主键排列</strong></li><li>若乱序插入 可能发生页分裂</li></ol><ul><li>前一页后50%部分与新数据挪至新页<ul><li>新页插入前一页与后一页间
<img loading=lazy src=5.jpg alt=页分裂示意图></li></ul></li></ul><h4 id=页合并>页合并<a hidden class=anchor aria-hidden=true href=#页合并>#</a></h4><ol><li>当页中删除的row达到MERGE-THRESHOLD（默认50%） InnoDB会寻找靠近的页进行合并<ul><li>MERGE-THRESHOLD 合并页的阈值 可自定义</li></ul></li></ol><h4 id=主键设计原则>主键设计原则<a hidden class=anchor aria-hidden=true href=#主键设计原则>#</a></h4><ol><li>尽量降低主键长度（占用的字节大小）</li><li>尽量顺序插入（自增主键）</li><li>尽量不用UUID（通用唯一识别码）或其它自然主键（如身份证号）为主键<ul><li>因为<strong>无序</strong></li></ul></li><li>避免修改主键</li></ol><h3 id=order-by优化>order by优化<a hidden class=anchor aria-hidden=true href=#order-by优化>#</a></h3><h4 id=extra显示>Extra显示<a hidden class=anchor aria-hidden=true href=#extra显示>#</a></h4><ol><li>Using index 通过索引排序</li><li>Using filesort 不可通过索引直接返回排序结果<ul><li>索引升序创建时 若倒序排序则需filesort</li></ul></li></ol><h4 id=优化>优化<a hidden class=anchor aria-hidden=true href=#优化>#</a></h4><ol><li>根据排序字段建立合适索引 多字段排序时也遵循最左前缀</li><li>尽量使用覆盖索引&注意升降序设定</li><li>不可避免出现filesort大数据量排序时 适当增加排序缓冲区sort_buffer_size大小</li></ol><h3 id=group-by优化>group by优化<a hidden class=anchor aria-hidden=true href=#group-by优化>#</a></h3><h4 id=extra显示-1>extra显示<a hidden class=anchor aria-hidden=true href=#extra显示-1>#</a></h4><ol><li>Using temporary 使用临时表（性能低）</li><li>Using index 使用索引</li></ol><ul><li>满足最左前缀</li></ul><h3 id=limit优化分页>limit优化（分页）<a hidden class=anchor aria-hidden=true href=#limit优化分页>#</a></h3><ul><li>limit不能用在in/all/any/some子语句中==多表查询 将limit的结果视为新表</li></ul><ol><li>覆盖索引 + 子查询<ul><li>原表与分页查到的主键id表联合查询name等索引覆盖的字段</li></ul></li></ol><h3 id=count优化>count优化<a hidden class=anchor aria-hidden=true href=#count优化>#</a></h3><ul><li>MyISAM将表的总行存在磁盘中 效率高</li><li>InnoDB需将数据从引擎中读出后累计计数</li></ul><h4 id=优化思路>优化思路<a hidden class=anchor aria-hidden=true href=#优化思路>#</a></h4><ol><li>自己计数（设定计数器cnt）</li></ol><h4 id=用法>用法<a hidden class=anchor aria-hidden=true href=#用法>#</a></h4><ol><li>count(*)<ul><li>不取值 直接累加</li></ul></li><li>count(主键)<ul><li>取主键id值 按行累加 主键不可能为NULL</li></ul></li><li>count(字段)<ul><li>字段为NULL时 count不加1</li><li>字段有not null约束时 不需判断null</li></ul></li><li>count(1)<ul><li>可以取-1等 服务层对返回的每一行放1（或-1）进去 后逐行累加</li></ul></li></ol><ul><li>效率：字段 &lt; 主键id &lt; 1 &lt; *</li></ul><h3 id=update优化>update优化<a hidden class=anchor aria-hidden=true href=#update优化>#</a></h3><ul><li>update优先行锁（有索引字段时 锁住该行）若无索引 执行表锁<ul><li>InnoDB的行锁针对索引</li></ul></li></ul><h2 id=视图>视图<a hidden class=anchor aria-hidden=true href=#视图>#</a></h2><blockquote><p>虚拟存在的表 只保存查询的逻辑不保存结果</p></blockquote><h3 id=视图语法>视图语法<a hidden class=anchor aria-hidden=true href=#视图语法>#</a></h3><ol><li><code>CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH [CASCADED |LOCAL] CHECK OPTION]</code><br>创建视图（OR REPLACE或替换视图）</li><li><code>SHOW CREATE VIEW 视图名</code><br>查看创建视图语句<br><code>SELECT * FROM 视图名</code><br>查看视图<ul><li>类似表</li></ul></li><li><code>CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH [CASCADED/LOCAL] CHECK OPTION]</code><br>修改视图（REPLACE为主要）<br><code>ALTER VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH [CASCADED/LOCAL] CHECK OPTION]</code><br>修改视图</li><li><code>DROP VIEW [IF EXISTS] 视图名称</code>
删除视图</li></ol><h3 id=检查选项>检查选项<a hidden class=anchor aria-hidden=true href=#检查选项>#</a></h3><ol><li><code>WITH [CASCADED/LOCAL] CHECK OPTION</code><ul><li>使之后对视图进行的增删改操作符合视图最初的定义</li><li><code>CASCADED/LOCAL</code> 检查依赖视图的规则 保持一致性 二者限定的范围不同<ul><li><code>CASCADED</code> （若v1未指定视图检查 但为v2的依赖视图 也会检查v1）检查<strong>所有亲辈</strong>的限制 无论其是否指定</li><li><code>LOCAL</code> 若v1未指定 则不检查v1</li></ul></li></ul></li></ol><h3 id=视图更新>视图更新<a hidden class=anchor aria-hidden=true href=#视图更新>#</a></h3><ol><li>可更新的视图：视图中的行与基础表的行一一对应<ul><li>包含 聚合/DISTINCT/GROUP BY/HAVING/UNION/… 的视图不可更新</li></ul></li></ol><h3 id=视图作用>视图作用<a hidden class=anchor aria-hidden=true href=#视图作用>#</a></h3><ol><li>简单 简化理解&操作（复杂且多次使用到的检索可以形成视图）</li><li>安全 可以只查看某表的部分内容（授权只能精确到表）</li><li>数据独立 屏蔽基表变化对查看信息带来的影响</li></ol><h2 id=存储过程>存储过程<a hidden class=anchor aria-hidden=true href=#存储过程>#</a></h2><blockquote><p>SQL语言的代码封装与重用</p></blockquote><h3 id=特点>特点<a hidden class=anchor aria-hidden=true href=#特点>#</a></h3><ol><li>封装 复用</li><li>可以接收参数 返回数据</li><li>减少应用途径与数据库间的网络交互 提升效率</li></ol><h3 id=语法>语法<a hidden class=anchor aria-hidden=true href=#语法>#</a></h3><ol><li>创建存储过程<pre tabindex=0><code>CREATE PROCEDURE 存储过程名([参数列表])*
BEGIN
——SQL语句
END;
</code></pre><ul><li>命令行中解决遇 ; 即停问题：用<code>delimiter 某符号</code>指定语句结束位置</li></ul></li></ol><blockquote><p>在DataGrip中存储为routines 中文“例程”</p></blockquote><ol><li><code>CALL 存储过程名([参数列表])</code>
调用存储过程</li><li><code>SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA='表名';</code><br>查询指定数据库的存储过程与状态<br><code>SELECT CREATE PROCEDURE 存储过程名</code><br>查询某存储过程的定义</li><li><code>DROP PROCEDURE 存储过程名</code>
删除存储过程</li></ol><h3 id=变量>变量<a hidden class=anchor aria-hidden=true href=#变量>#</a></h3><h4 id=系统变量>系统变量<a hidden class=anchor aria-hidden=true href=#系统变量>#</a></h4><ol><li>由服务器提供 分为全局变量GLOBAL与会话变量SESSION（仅在当前会话 即当前控制台 生效）<ul><li>默认SESSION</li><li>系统重启后全局参数失效 可在/etc/my.cnf中配置</li></ul></li><li><code>SHOW [SESSION/GLOBAL] VARIABLES;</code><br>查看所有系统变量<br><code>SHOW [SESSION/GLOBAL] VARIABLES LIKE '…';</code><br>模糊匹配<br><code>SELECT @@[SESSION/GLOBAL] 系统变量名;</code><br>查看指定变量的值<ul><li>系统变量用@@</li></ul></li><li><code>SET [SESSION/GLOBAL] 系统变量名=值</code><br><code>SELECT @@[SESSION/GLOBAL] 系统变量名=值</code><br>设置系统变量<ul><li><code>SET SESSION AUTOCOMMIT =0</code>
切换到手动提交</li></ul></li></ol><h4 id=用户自定义变量>用户自定义变量<a hidden class=anchor aria-hidden=true href=#用户自定义变量>#</a></h4><blockquote><p>不用提前声明 通过“@变量名”使用(未定义时调用返回null)
作用域为当前</p></blockquote><ol><li><code>SET @变量名=值;</code><br><code>SET @变量名:=值;</code><br><code>SELECT @变量名=值;</code><br>赋值 可多个同时赋值<br><code>SELECT 字段名 INTO @变量名 FROM 表名;</code><ul><li>将字段名结果赋值给变量</li></ul></li><li><code>SELECT @变量名</code>
使用变量</li></ol><h4 id=局部变量>局部变量<a hidden class=anchor aria-hidden=true href=#局部变量>#</a></h4><blockquote><p>作用域在begin…end块之间
<strong>先声明</strong>后调用</p></blockquote><ol><li><code>DECLARE 变量名 变量类型 [DEFAULT …];</code>
声明（有否默认值）</li><li><code>SET 变量名 := 值</code><br><code>SELECT 字段名 INTO 变量名 FROM 表名;</code><br>为变量赋值</li></ol><h3 id=条件判断循环>条件判断&循环<a hidden class=anchor aria-hidden=true href=#条件判断循环>#</a></h3><h4 id=if>if<a hidden class=anchor aria-hidden=true href=#if>#</a></h4><pre tabindex=0><code>IF 条件1 THEN
   …;
   ELSEIF 条件2 THEN
   …;
   ELSE
   …;
   END IF;
</code></pre><blockquote><p>用SELECT语句显示返回值</p></blockquote><h4 id=参数>参数<a hidden class=anchor aria-hidden=true href=#参数>#</a></h4><ol><li>类型<table><thead><tr><th style=text-align:center>类型</th><th style=text-align:center>含义</th><th style=text-align:center>备注</th></tr></thead><tbody><tr><td style=text-align:center>IN</td><td style=text-align:center>输入 调用时传入值</td><td style=text-align:center>默认</td></tr><tr><td style=text-align:center>OUT</td><td style=text-align:center>输出 可为返回值</td><td></td></tr><tr><td style=text-align:center>INOUT</td><td style=text-align:center>输入&输出</td><td></td></tr></tbody></table></li><li><code>CREATE PROCEDURE 存储过程名([IN/OUT/INOUT 参数名 参数类型])</code></li></ol><h4 id=case>case<a hidden class=anchor aria-hidden=true href=#case>#</a></h4><pre tabindex=0><code>CASE [变量]
   WHEN … THEN …;
   …
   ELSE …
   END CASE;
</code></pre><h4 id=while>while<a hidden class=anchor aria-hidden=true href=#while>#</a></h4><pre tabindex=0><code>WHILE 条件 DO
   SQL逻辑
   END WHILE
    条件为true时进行
</code></pre><h4 id=repeat>repeat<a hidden class=anchor aria-hidden=true href=#repeat>#</a></h4><pre tabindex=0><code>REPEAT
SQL逻辑
UNTIL 条件
END REPEAT
</code></pre><ul><li>先执行一次逻辑 若条件满足则停止循环</li></ul><h4 id=loop>loop<a hidden class=anchor aria-hidden=true href=#loop>#</a></h4><ol><li><pre tabindex=0><code>[begin_label:] LOOP
…
END LOOP [end_label];
</code></pre></li><li>配合语句：
<code>LEAVE LABEL;</code> 退出循环
<code>ITERATE LABEL;</code> 只可在循环中使用 跳过当前循环剩下的语句进入下一次循环</li></ol><h3 id=游标条件处理程序>游标&条件处理程序<a hidden class=anchor aria-hidden=true href=#游标条件处理程序>#</a></h3><h4 id=游标>游标<a hidden class=anchor aria-hidden=true href=#游标>#</a></h4><blockquote><p>暂时存储查询结果<strong>集</strong>的数据类型（集合）</p></blockquote><ol><li><code>DECLARE 游标名 CURSOR FOR 查询语句;</code>
声明游标</li><li><code>OPEN 游标名</code>
打开游标</li><li><code>FETCH 游标名 INTO 变量;</code>
获取游标记录（可以是多个变量）</li><li><code>CLOSE 游标名</code>
关闭游标</li><li>使用游标记录结果集 开启游标通过循环获取游标内的数据</li></ol><h4 id=条件处理程序>条件处理程序<a hidden class=anchor aria-hidden=true href=#条件处理程序>#</a></h4><blockquote><p>定义在流程控制结构执行过程中遇到问题的处理步骤</p></blockquote><ol><li><code>DECLARE 处理动作 HANDLER FOR 状况值 … statement;</code>
处理动作：<ul><li>CONTINUE 继续执行当前程序</li><li>EXIT 终止
状况值：</li><li><code>SQLSTATE 状态码</code> 可用下列替代<ul><li>SQLWARNING（01开头的状态码）</li><li>NOT FOUND（02开头的状态码）</li><li>SQLEXCEPTION（除以上两种的其它）
<img loading=lazy src=%e6%b8%b8%e6%a0%87.png alt=游标使用例图 title=游标图></li></ul></li></ul></li></ol><h2 id=存储函数>存储函数<a hidden class=anchor aria-hidden=true href=#存储函数>#</a></h2><blockquote><p>有返回值 参数必为IN类型（应用少）</p></blockquote><ol><li><pre tabindex=0><code>CREATE FUNCTION 存储函数名([参数列表])
RETURNS 数据类型 [characteristic]
BEGIN
——SQL语句
END;
</code></pre></li></ol><p>characteristic：（二级日志开启 默认需加）</p><ul><li>DETERMINISTIC 相同输入产生相同结果</li><li>NO SQL 不包含SQL语句</li><li>READ SQL DATA 包含读取数据的语句 不包含写入数据的语句</li></ul><h2 id=触发器>触发器<a hidden class=anchor aria-hidden=true href=#触发器>#</a></h2><h3 id=触发器定义>触发器定义<a hidden class=anchor aria-hidden=true href=#触发器定义>#</a></h3><ol><li>与表有关的数据库对象。在insert/update/delete之前或之后，触发并执行其定义的语句（多为记录数据变更日志）</li><li>OLD与NEW引用触发器中发生变化的记录内容<ul><li>如insert用NEW；update用OLD（引用需修改的内容）与NEW（引用修改后的内容）</li></ul></li><li>只支持行级触发器 不支持语句级触发</li></ol><h3 id=触发器语法>触发器语法<a hidden class=anchor aria-hidden=true href=#触发器语法>#</a></h3><ol><li><pre tabindex=0><code>CREATE TRIGGER 触发器名
BEFORE/AFTER INSERT/… ON 表名 FOR EACH ROW——行级触发器
BEGIN
语句（将修改的内容放入新建的日志表中）
END;
</code></pre>创建触发器<ul><li>“语句”为将新操作记录插入日志表（自建）<ul><li>可以记录插入的详细信息 用 concat() 拼接字符串</li></ul></li></ul></li><li><code>SHOW TRIGGERS;</code>
查看触发器</li><li><code>DROP TRIGGER [数据库名.]触发器名;</code>
删除触发器</li></ol><h2 id=锁>锁<a hidden class=anchor aria-hidden=true href=#锁>#</a></h2><h3 id=概述>概述<a hidden class=anchor aria-hidden=true href=#概述>#</a></h3><ol><li>协调多进程或线程并发访问某资源的机制<ul><li>事务中进行</li></ul></li><li>分类<ul><li>全局锁 数据库中所有表</li><li>表级锁</li><li>行级锁</li></ul></li></ol><h3 id=全局锁>全局锁<a hidden class=anchor aria-hidden=true href=#全局锁>#</a></h3><blockquote><p>通常用做全数据库的逻辑备份</p></blockquote><h4 id=语法-1>语法<a hidden class=anchor aria-hidden=true href=#语法-1>#</a></h4><ol><li><code>FLUSH TABLES WITH READ LOCK</code>
加全局锁</li><li><code>MYSQLDUMP -UROOT -P1234 数据库名>保存地点</code>
备份数据库<ul><li>在命令行中运行 非mysql语句</li><li>用户名root 密码1234</li></ul></li><li><code>UNLOCK TABLES</code>
释放锁</li></ol><h4 id=特点不重要>特点（不重要）<a hidden class=anchor aria-hidden=true href=#特点不重要>#</a></h4><ol><li>若主库备份 备份期间不能更新主库</li><li>若从库备份 备份期间从库不能执行主库同步来的二进制日志 导致主从延迟</li><li><code>MYSQLDUMP --SINGLE-TRANSACTION -UROOT -P1234 数据库名>保存地点</code>
不需加全局锁的备份</li></ol><h3 id=表级锁>表级锁<a hidden class=anchor aria-hidden=true href=#表级锁>#</a></h3><blockquote><p>锁定粒度大 发生所冲突的概率最高 并发度最低</p></blockquote><ol><li>分类：<ul><li>表锁</li><li>元数据锁</li><li>意向锁</li></ul></li></ol><h4 id=表锁>表锁<a hidden class=anchor aria-hidden=true href=#表锁>#</a></h4><ol><li>分类：<ul><li>表共享读锁</li><li>表独占写锁</li></ul></li><li><code>LOCK TABLES 表名… READ/WRITE</code>
加锁<ul><li>读锁 所有客户端都可读 不可写</li><li>写锁 当前客户端可读 / 写 其他客户端<strong>不可</strong>读 / 写
<img loading=lazy src=%e8%af%bb%e5%86%99%e9%94%81.png alt=读写 title=读写锁></li></ul></li><li><code>UNLOCK TABLES</code>
释放锁</li></ol><h4 id=元数据锁meta-data-lockmdl>元数据锁(meta data lock,MDL)<a hidden class=anchor aria-hidden=true href=#元数据锁meta-data-lockmdl>#</a></h4><blockquote><p>系统自动控制</p></blockquote><ol><li>维护表元数据的数据一致性==表上有活动事务时不可对元数据进行写入<ul><li>避免DML与DDL冲突</li><li>MySql5.5后 DML增删改查加读锁 DDL对表结构变更加写锁</li></ul></li><li><code>SELECT OBJECT_SCHEMA,OBJECT_NAME,INDEX_NAME,LOCK_TYPE,LOCK_MODE,LOCK_DATA FROM PERFORMANCE_SCHEMA.METADATA_LOCKS;</code>
查看元数据锁</li></ol><h4 id=意向锁>意向锁<a hidden class=anchor aria-hidden=true href=#意向锁>#</a></h4><ol><li>使表锁不用检查每行数据是否加行锁 避免DML执行时行锁与表锁冲突</li><li>分类：<ul><li>意向共享锁(IS)</li><li>意向排他锁(IX)</li></ul></li><li><code>SELECT OBJECT_SCHEMA,OBJECT_NAME,INDEX_NAME,LOCK_TYPE,LOCK_MODE,LOCK_DATA FROM PERFORMANCE_SCHEMA.DATA_LOCKS;</code><br>查看锁<ul><li>日志中<code>RECORD</code>锁类型代表行锁</li></ul></li></ol><blockquote><p>意向锁间不互斥</p></blockquote><h5 id=is-意向共享锁>IS 意向共享锁<a hidden class=anchor aria-hidden=true href=#is-意向共享锁>#</a></h5><ol><li>由<code>SELECT语句 LOCK IN SHARE MODE</code>添加</li><li>与表锁共享读锁(read)兼容 与表锁排它写锁(write)互斥</li></ol><h5 id=ix-意向排他锁>IX 意向排他锁<a hidden class=anchor aria-hidden=true href=#ix-意向排他锁>#</a></h5><ol><li>由<code>增删改语句 FOR UPDATE</code>添加</li><li>与表锁共享读锁(read)互斥 与表锁排它写锁(write)互斥</li></ol><h3 id=行级锁>行级锁<a hidden class=anchor aria-hidden=true href=#行级锁>#</a></h3><blockquote><p>锁定粒度最小 锁冲突改率最低 并发度最高
在InnoDB存储引擎中应用</p></blockquote><ol><li>分类：<ul><li>行锁 锁定单个行记录——在RC RR隔离级别下都支持（包括共享锁与排他锁）</li><li>间隙锁 确保索引记录间隙不变 防止insert产生幻读——在RR下支持</li><li>临键锁 行锁+间隙锁（该行<strong>之前</strong>的间隙）——RR下支持</li></ul></li><li>行锁类型<table><thead><tr><th style=text-align:center>SQL</th><th style=text-align:center>行锁类型</th><th style=text-align:center>说明</th></tr></thead><tbody><tr><td style=text-align:center>增删改</td><td style=text-align:center>排他锁</td><td style=text-align:center>自动加</td></tr><tr><td style=text-align:center>SELECT语句</td><td style=text-align:center>无锁</td><td></td></tr><tr><td style=text-align:center>SELECT加共享锁</td><td style=text-align:center>共享锁S</td><td style=text-align:center>手动</td></tr><tr><td style=text-align:center>SELECT…FOR UPDATE</td><td style=text-align:center>排他锁X</td><td style=text-align:center>手动</td></tr></tbody></table></li></ol><h4 id=行锁>行锁<a hidden class=anchor aria-hidden=true href=#行锁>#</a></h4><blockquote><p>InnoDB使用next-key（临键锁）进行搜索与索引扫描 以防止幻读</p></blockquote><ol><li>针对唯一索引检索时 对存在的记录进行等值匹配（通过 “=” 检索）时会自动将next-key锁优化为行锁</li><li>InnoDB中不通过索引检索数据会升级为表锁</li></ol><h4 id=间隙锁临键锁-font-color32cd32理解font>间隙锁&临键锁 理解<a hidden class=anchor aria-hidden=true href=#间隙锁临键锁-font-color32cd32理解font>#</a></h4><ol><li>唯一索引的等值查询 给不存在的记录加锁时 优化为间隙锁</li><li>普通索引的等值查询 向右遍历到最后一个值不满足查询需求时 临键锁退化为间隙锁</li><li>唯一索引的范围查询 访问到不满足条件的第一个值为止（加锁）<ul><li>间隙锁可以共存（只为防止其它事务插入间隙so）</li></ul></li></ol><h2 id=innodb引擎-font-color32cd32理解font>InnoDB引擎 理解<a hidden class=anchor aria-hidden=true href=#innodb引擎-font-color32cd32理解font>#</a></h2><h3 id=整体架构>整体架构<a hidden class=anchor aria-hidden=true href=#整体架构>#</a></h3><h4 id=内存架构>内存架构<a hidden class=anchor aria-hidden=true href=#内存架构>#</a></h4><blockquote><p>直接操作</p></blockquote><ol><li>缓冲池 Buffer Pool</li><li>Change Buffer 对非唯一的二级索引进行修改 操作存储在此（先到缓冲池 后到磁盘）</li><li>Adaptive Hash Index 优化对缓冲池数据的查询(自动生成)<ul><li>用<code>SHOW VARIABLES LIKE '%HASH_INDEX%';</code>查看其是否启用（模糊匹配）</li></ul></li><li>Log Buffer 日志缓冲区 保存要写入磁盘的log<ul><li><code>INNODB_LOG_BUFFER_SIZE</code>查看大小</li><li><code>INNODB_FLUSH_LOG_AT_TRX_COMMIT</code>刷新到磁盘的时机（可设置0 1 2 具体含义略）
<img loading=lazy src=%e5%86%85%e5%ad%98.png alt=内存架构></li></ul></li></ol><h4 id=磁盘结构>磁盘结构<a hidden class=anchor aria-hidden=true href=#磁盘结构>#</a></h4><ol><li>System Tablespaces系统表空间 主要存放Change Buffer<ul><li><code>%DATA_FILE_PATH%</code>模糊匹配</li></ul></li><li>General Tablespaces通用表空间 需在创建表时指定<ul><li><code>CREATE TABLESPACE</code>创建该表空间</li></ul></li><li>Undo Tablespaces撤销表空间 自动创建两个</li><li>Temporary Tablespaces临时表空间</li><li>DoubleWrite Buffer Files双写缓冲区（缓冲池刷新到磁盘前先写入此）</li><li>Redo Log重做日志 实现事务持久性（包括重做日志缓冲 储存在内存中）
<img loading=lazy src=%e7%a3%81%e7%9b%98.png alt=磁盘空间></li></ol><h4 id=后台线程>后台线程<a hidden class=anchor aria-hidden=true href=#后台线程>#</a></h4><blockquote><p>将缓冲区数据刷新到磁盘中</p></blockquote><ol><li>Master Thread核心后台线程<ul><li>调度其他线程</li></ul></li><li>IO Thread 负责IO请求的回调
<img loading=lazy src=io%e7%ba%bf%e7%a8%8b.png alt=IO></li><li>Purge Thread 回收事务已提交的undo log</li><li>Page Cleaner Thread减轻主线程刷新脏页的压力</li></ol><h3 id=事务原理>事务原理<a hidden class=anchor aria-hidden=true href=#事务原理>#</a></h3><h4 id=redo-log>redo log<a hidden class=anchor aria-hidden=true href=#redo-log>#</a></h4><ol><li>刷新脏页到磁盘发生错误时进行数据恢复（物理日志）</li></ol><h4 id=undo-log>undo log<a hidden class=anchor aria-hidden=true href=#undo-log>#</a></h4><ol><li>回滚日志（逻辑日志） 记录数据被修改前的信息</li><li>MVCC需要</li></ol><h3 id=mvcc>MVCC⭐<a hidden class=anchor aria-hidden=true href=#mvcc>#</a></h3><blockquote><p>多版本并发控制 Multi-Version Concurrency Control</p></blockquote><h4 id=基本概念>基本概念<a hidden class=anchor aria-hidden=true href=#基本概念>#</a></h4><ol><li>当前读 读取记录数据的最新版本并对记录加锁<ul><li>共享锁/排他锁/增删改</li></ul></li><li>快照读 读取记录数据的可见（历史）版本 不加锁<ul><li>RC隔断下 <strong>每次select生成一个快照读</strong></li><li>RR 开启事务后<strong>第一个select</strong>才是快照读</li><li>S 快照读退化为当前读</li></ul></li><li>MVCC 维护一个数据的多个版本 使读写操作没有冲突<ul><li>快照读为其提供非阻塞读功能</li><li>依赖于：<ul><li>数据库记录中的三个隐式字段</li><li>undo log</li><li>readView</li></ul></li></ul></li></ol><h4 id=实现原理>实现原理<a hidden class=anchor aria-hidden=true href=#实现原理>#</a></h4><ol><li><p>三个隐式字段 （InnoDB隐式生成）</p><table><thead><tr><th style=text-align:center>隐藏字段</th><th style=text-align:center>含义</th></tr></thead><tbody><tr><td style=text-align:center>DB_TRX-ID</td><td style=text-align:center>最近修改事务ID</td></tr><tr><td style=text-align:center>DB_ROLL_PTR</td><td style=text-align:center>回滚指针 指向这条记录的上个版本 配合undo log</td></tr><tr><td style=text-align:center>DB_ROW_ID</td><td style=text-align:center>隐藏主键 若无指定主键则生成此字段</td></tr></tbody></table></li><li><p>undo log日志（增删改时产生便于数据回滚的日志）</p><ul><li>insert 只在回滚时需要log 事务提交后可被删除</li><li>删改 在回滚与快照读时需要（不会被立即删除）</li><li>生成undo log版本链 头部是最新的历史记录 尾部是最旧的历史记录</li></ul></li><li><p>ReadView 记录并维护系统当前活跃（未提交）的事务id（MVCC提取数据的依据）</p><ul><li>四个核心字段</li></ul><table><thead><tr><th style=text-align:center>字段</th><th style=text-align:center>含义</th></tr></thead><tbody><tr><td style=text-align:center>m_ids</td><td style=text-align:center>当前活跃事务ID集合</td></tr><tr><td style=text-align:center>min_trx_id</td><td style=text-align:center>最小活跃事务ID</td></tr><tr><td style=text-align:center>max_trx_id</td><td style=text-align:center>预分配事务ID（当前最大事务ID+1 自增）</td></tr><tr><td style=text-align:center>creator_trx_id</td><td style=text-align:center>ReadView创建者的事务ID</td></tr></tbody></table><ul><li>版本链数据访问规则（当前事务ID为trx_id 即DB_TRX_ID）理解
只可符合下列四个条件 若都不符合 则换下一条undo log<ul><li>trx_id==creator_trx_id ✔
说明数据由当前事务更改</li><li>trx_id&lt;min_trx_id ✔
说明数据已提交</li><li>trx_id>max_trx_id ✖
事务在RV生成后才开始</li><li>min_trx_id&lt;=trx_id&lt;=max_trx_id 且trx_id不在m_ids中 ✔
说明数据已提交</li></ul></li><li>RC隔离级别 事务中每次执行快照读时生成ReadView</li><li>RR隔离级别 事务中第一次执行快照读时生成 后复用</li></ul></li></ol><h2 id=mysql管理>MySql管理<a hidden class=anchor aria-hidden=true href=#mysql管理>#</a></h2><h3 id=系统数据库>系统数据库<a hidden class=anchor aria-hidden=true href=#系统数据库>#</a></h3><ol><li>自带四个数据库
<img loading=lazy src=%e6%95%b0%e6%8d%ae%e5%ba%93.png alt=数据库><table><thead><tr><th style=text-align:center>数据库</th><th style=text-align:center>作用</th></tr></thead><tbody><tr><td style=text-align:center>mysql</td><td style=text-align:center>服务器运行需要的信息（时区 主从 用户 权限等）</td></tr><tr><td style=text-align:center>information_schema</td><td style=text-align:center>访问元数据的表、视图等</td></tr><tr><td style=text-align:center>performance_schema</td><td style=text-align:center>底层监控服务器运行状态 收集其性能参数</td></tr><tr><td style=text-align:center>sys</td><td style=text-align:center>方便DBA 便于性能调优与诊断的视图</td></tr></tbody></table></li></ol><h3 id=常用工具>常用工具<a hidden class=anchor aria-hidden=true href=#常用工具>#</a></h3><ol><li><code>MySQL 数据库名 -e "执行语句"</code>
-e执行sql语句并退出 适用于shell脚本</li><li><code>mysqladmin -uroot -p****** …</code> 查看帮助文档并进行相关操作</li><li><code>mysqlbinlog log1</code> 查看二进制日志文件</li><li><code>mysqlshow …</code> 查找数据库/表/列/索引等</li><li><code>mysqldump [options] db_name</code>备份数据库</li><li><code>mysqllimport或source</code> 客户端数据（mysqldump加-T参数导出的文本文件）导入
🎉🎉</li></ol><script type=module>  
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; 
    mermaid.initialize({ startOnLoad: true });  
</script><script>Array.from(document.getElementsByClassName("language-mermaid")).forEach(e=>{e.parentElement.outerHTML=`<div class="mermaid">${e.innerHTML}</div>`})</script><style>.mermaid svg{display:block;margin:auto}</style></div><footer class=post-footer><ul class=post-tags><li><a href=https://Sattiluvcat.github.io/en/tags/mysql/>MySql</a></li></ul><nav class=paginav><a class=next href=https://Sattiluvcat.github.io/en/posts/java/redis%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B0/><span class=title>Next »</span><br><span>Redis_base</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share MySql on x" href="https://x.com/intent/tweet/?text=MySql&amp;url=https%3a%2f%2fSattiluvcat.github.io%2fen%2fposts%2fjava%2fmysql%2f&amp;hashtags=MySql"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MySql on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fSattiluvcat.github.io%2fen%2fposts%2fjava%2fmysql%2f&amp;title=MySql&amp;summary=MySql&amp;source=https%3a%2f%2fSattiluvcat.github.io%2fen%2fposts%2fjava%2fmysql%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MySql on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fSattiluvcat.github.io%2fen%2fposts%2fjava%2fmysql%2f&title=MySql"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MySql on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fSattiluvcat.github.io%2fen%2fposts%2fjava%2fmysql%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MySql on whatsapp" href="https://api.whatsapp.com/send?text=MySql%20-%20https%3a%2f%2fSattiluvcat.github.io%2fen%2fposts%2fjava%2fmysql%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MySql on telegram" href="https://telegram.me/share/url?text=MySql&amp;url=https%3a%2f%2fSattiluvcat.github.io%2fen%2fposts%2fjava%2fmysql%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share MySql on ycombinator" href="https://news.ycombinator.com/submitlink?t=MySql&u=https%3a%2f%2fSattiluvcat.github.io%2fen%2fposts%2fjava%2fmysql%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://www-sattiluvcat-github-io.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><script id=dsq-count-scr src=//www-sattiluvcat-github-io.disqus.com/count.js async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://Sattiluvcat.github.io/en/>Satti's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>